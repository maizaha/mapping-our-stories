//select zip codes that are part of South LA
var zips = {
    "type": "FeatureCollection",
    "name": "ca_zipcodes",
    "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
    "features": [
        {"type": "Feature", "properties": { "OBJECTID_1": 1619, "objectid": 1619, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90001", "zcta_key": "0690001", "latitude": 33.97402729, "longitude": -118.24950897, "tot_pop": 57110, "age_under5": 5733, "age_5to9": 5321, "age_10to14": 5491, "age_15to19": 5580, "age_20to24": 4905, "age_25to29": 4635, "age_30to34": 4423, "age_35to39": 4180, "age_40to44": 3727, "age_45to49": 3243, "age_50to54": 2902, "age_55to59": 2173, "age_60to64": 1618, "age_65to69": 1073, "age_70to74": 756, "age_75to79": 547, "age_80to84": 416, "age_85_ove": 387, "age16_over": 39467, "age18_over": 37131, "age21_over": 33962, "age62_over": 4102, "age65_over": 3179, "male": 28468, "female": 28642, "age_median": 26.6, "age_medi_1": 26.1, "age_medi_2": 27.1, "one_race": 54985, "white": 20509, "black_afam": 6133, "amind_alan": 410, "asian": 145, "nathaw_isl": 27, "other_race": 27761, "multi_race": 2125, "hispanic_l": 50544, "non_hisp_l": 6566, "white_nhl": 356, "black_af_1": 5857, "amind_al_1": 39, "asian_nhl": 86, "nathaw_i_1": 14, "other_nhl": 85, "multi_ra_1": 129, "tot_in_hou": 57057, "tot_in_gc": 53, "gc_inst": 6, "gc_noninst": 47, "gc_correct": 0, "gc_juv": 6, "gc_nurs": 0, "gc_other": 0, "hh_total": 12971, "hh_family": 11211, "hh_nonfaml": 1760, "hh_nonfami": 1244, "hh_nonfa_1": 634, "hh_nonfa_2": 162, "hh_nonfa_3": 610, "hh_nonfa_4": 291, "hh_with_un": 8399, "hh_with_65": 2543, "hu_total": 13788, "hu_occ": 12971, "hu_vac": 817, "hu_vac_ren": 399, "hu_vac_sea": 22, "hu_occ_own": 4536, "hu_occ_o_1": 21509, "hu_occ_ren": 8435, "hu_occ_r_1": 35548, "Shape_Length": 0.12749474899693333, "Shape_Area": 0.00089640817149042702, "InPoly_FID": 1618, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },"geometry": { "type": "Polygon","coordinates": [[[-118.237949000146216, 33.960150000122439],[-118.237369999525811, 33.958521000543783],[-118.237366000240684, 33.960152000214691],[-118.23001300019979, 33.961767999193853],[-118.237907000008022, 33.989333000517604],[-118.243139000264591, 33.989443000194342],[-118.265184999787891, 33.989226999226673],[-118.265174000179911, 33.981827999762459],[-118.262980999773276, 33.981836000131352],[-118.262969000119199, 33.974746000527546],[-118.265165999811018, 33.974735000020303],[-118.265118000295445, 33.960130000099468],[-118.237949000146216, 33.960150000122439]]]}},
        {"type": "Feature","properties": { "OBJECTID_1": 1380, "objectid": 1380, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90002", "zcta_key": "0690002", "latitude": 33.94909876, "longitude": -118.24673723, "tot_pop": 51223, "age_under5": 5318, "age_5to9": 4933, "age_10to14": 5034, "age_15to19": 5289, "age_20to24": 4583, "age_25to29": 4098, "age_30to34": 3550, "age_35to39": 3243, "age_40to44": 3175, "age_45to49": 3053, "age_50to54": 2757, "age_55to59": 1937, "age_60to64": 1331, "age_65to69": 946, "age_70to74": 705, "age_75to79": 525, "age_80to84": 359, "age_85_ove": 387, "age16_over": 34872, "age18_over": 32719, "age21_over": 29665, "age62_over": 3626, "age65_over": 2922, "male": 24876, "female": 26347, "age_median": 25.5, "age_medi_1": 24.6, "age_medi_2": 26.5, "one_race": 49284, "white": 14392, "black_afam": 13101, "amind_alan": 371, "asian": 148, "nathaw_isl": 33, "other_race": 21239, "multi_race": 1939, "hispanic_l": 37598, "non_hisp_l": 13625, "white_nhl": 330, "black_af_1": 12723, "amind_al_1": 62, "asian_nhl": 102, "nathaw_i_1": 21, "other_nhl": 84, "multi_ra_1": 303, "tot_in_hou": 51091, "tot_in_gc": 132, "gc_inst": 0, "gc_noninst": 132, "gc_correct": 0, "gc_juv": 0, "gc_nurs": 0, "gc_other": 0, "hh_total": 11731, "hh_family": 9779, "hh_nonfaml": 1952, "hh_nonfami": 1548, "hh_nonfa_1": 663, "hh_nonfa_2": 231, "hh_nonfa_3": 885, "hh_nonfa_4": 444, "hh_with_un": 7407, "hh_with_65": 2436, "hu_total": 12598, "hu_occ": 11731, "hu_vac": 867, "hu_vac_ren": 428, "hu_vac_sea": 14, "hu_occ_own": 4684, "hu_occ_o_1": 22498, "hu_occ_ren": 7047, "hu_occ_r_1": 28593, "Shape_Length": 0.13215261371965667, "Shape_Area": 0.00078571083587691565, "InPoly_FID": 1379, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },"geometry": {"type": "Polygon","coordinates": [[[-118.237369999525811, 33.958521000543783],[-118.237949000146216, 33.960150000122439],[-118.265118000295445, 33.960130000099468],[-118.265158000341387, 33.939292000525484],[-118.243742000193095, 33.93785299981613],[-118.243180000356688, 33.941513000424663],[-118.242741999943291, 33.938455999744633],[-118.228753000550512, 33.938874000135058],[-118.229212999280435, 33.937331000025665],[-118.226772000027722, 33.937095999980443],[-118.226507000397703, 33.938196000345215],[-118.231484999732913, 33.960937999589078],[-118.229647000408704, 33.961199999980067],[-118.23001300019979, 33.961767999193853],[-118.237366000240684, 33.960152000214691],[-118.237369999525811, 33.958521000543783]]]}},
        {"type": "Feature","properties": { "OBJECTID_1": 85, "objectid": 85, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90003", "zcta_key": "0690003", "latitude": 33.96413596, "longitude": -118.27371904, "tot_pop": 66266, "age_under5": 6837, "age_5to9": 6193, "age_10to14": 6422, "age_15to19": 6523, "age_20to24": 5750, "age_25to29": 5532, "age_30to34": 5059, "age_35to39": 4645, "age_40to44": 4162, "age_45to49": 3967, "age_50to54": 3478, "age_55to59": 2572, "age_60to64": 1708, "age_65to69": 1172, "age_70to74": 823, "age_75to79": 642, "age_80to84": 402, "age_85_ove": 379, "age16_over": 45461, "age18_over": 42791, "age21_over": 39115, "age62_over": 4360, "age65_over": 3418, "male": 32631, "female": 33635, "age_median": 26.3, "age_medi_1": 25.5, "age_medi_2": 27.1, "one_race": 63750, "white": 19878, "black_afam": 16181, "amind_alan": 516, "asian": 149, "nathaw_isl": 58, "other_race": 26968, "multi_race": 2516, "hispanic_l": 49386, "non_hisp_l": 16880, "white_nhl": 462, "black_af_1": 15672, "amind_al_1": 80, "asian_nhl": 105, "nathaw_i_1": 18, "other_nhl": 171, "multi_ra_1": 372, "tot_in_hou": 65965, "tot_in_gc": 301, "gc_inst": 6, "gc_noninst": 295, "gc_correct": 0, "gc_juv": 6, "gc_nurs": 0, "gc_other": 0, "hh_total": 15642, "hh_family": 12986, "hh_nonfaml": 2656, "hh_nonfami": 2059, "hh_nonfa_1": 929, "hh_nonfa_2": 239, "hh_nonfa_3": 1130, "hh_nonfa_4": 463, "hh_with_un": 9856, "hh_with_65": 2808, "hu_total": 17127, "hu_occ": 15642, "hu_vac": 1485, "hu_vac_ren": 772, "hu_vac_sea": 18, "hu_occ_own": 5137, "hu_occ_o_1": 24231, "hu_occ_ren": 10505, "hu_occ_r_1": 41734, "Shape_Length": 0.14505974344700884, "Shape_Area": 0.00090506010091739419, "InPoly_FID": 84, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },"geometry": {"type": "Polygon","coordinates": [[[-118.283203999764737, 33.989138999665158],[-118.282594000412757, 33.939180999903272],[-118.265158000341387, 33.938348000160147],[-118.265158000341387, 33.939292000525484],[-118.265118000295445, 33.960130000099468],[-118.265165999811018, 33.974735000020303],[-118.262969000119199, 33.974746000527546],[-118.262980999773276, 33.981836000131352],[-118.265174000179911, 33.981827999762459],[-118.265184999787891, 33.989226999226673],[-118.270528000666673, 33.98920500001077],[-118.270526000574421, 33.986067000092021],[-118.273927999177772, 33.989191000264498],[-118.283203999764737, 33.989138999665158]]]}},
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 993, "objectid": 993, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90007", "zcta_key": "0690007", "latitude": 34.02813286, "longitude": -118.28482837, "tot_pop": 40920, "age_under5": 2093, "age_5to9": 1887, "age_10to14": 2004, "age_15to19": 4046, "age_20to24": 11830, "age_25to29": 4127, "age_30to34": 2474, "age_35to39": 2013, "age_40to44": 2011, "age_45to49": 1704, "age_50to54": 1687, "age_55to59": 1393, "age_60to64": 1088, "age_65to69": 806, "age_70to74": 595, "age_75to79": 478, "age_80to84": 370, "age_85_ove": 314, "age16_over": 34528, "age18_over": 33568, "age21_over": 27667, "age62_over": 3161, "age65_over": 2563, "male": 20915, "female": 20005, "age_median": 24.0, "age_medi_1": 23.9, "age_medi_2": 24.2, "one_race": 38741, "white": 15849, "black_afam": 4547, "amind_alan": 274, "asian": 6317, "nathaw_isl": 44, "other_race": 11710, "multi_race": 2179, "hispanic_l": 22167, "non_hisp_l": 18753, "white_nhl": 7053, "black_af_1": 4306, "amind_al_1": 39, "asian_nhl": 6243, "nathaw_i_1": 34, "other_nhl": 207, "multi_ra_1": 871, "tot_in_hou": 35846, "tot_in_gc": 5074, "gc_inst": 157, "gc_noninst": 4917, "gc_correct": 135, "gc_juv": 22, "gc_nurs": 0, "gc_other": 0, "hh_total": 11944, "hh_family": 5791, "hh_nonfaml": 6153, "hh_nonfami": 3301, "hh_nonfa_1": 1718, "hh_nonfa_2": 255, "hh_nonfa_3": 1583, "hh_nonfa_4": 530, "hh_with_un": 3650, "hh_with_65": 2001, "hu_total": 12762, "hu_occ": 11944, "hu_vac": 818, "hu_vac_ren": 547, "hu_vac_sea": 46, "hu_occ_own": 1292, "hu_occ_o_1": 5540, "hu_occ_ren": 10652, "hu_occ_r_1": 30306, "Shape_Length": 0.15652969337635006, "Shape_Area": 0.00062111574869443695, "InPoly_FID": 992, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.300164999515061, 34.018177000568187],
                        [-118.293070999726808, 34.018160000683508],
                        [-118.291536999133143, 34.015480999448641],
                        [-118.282758999927864, 34.01651400032091],
                        [-118.274009000215131, 34.013057000080551],
                        [-118.272625000243522, 34.018654000082108],
                        [-118.268370999222213, 34.018818000450437],
                        [-118.271600999786301, 34.020255999314941],
                        [-118.264678999835951, 34.030990999734911],
                        [-118.276742999489784, 34.036514999967324],
                        [-118.279192000010767, 34.034653999582474],
                        [-118.277704999785897, 34.036950999389148],
                        [-118.282852999766078, 34.037617999571069],
                        [-118.284101999807433, 34.039855000208149],
                        [-118.300348999906362, 34.039969000069334],
                        [-118.300164999515061, 34.018177000568187]
                    ],
                    [
                        [-118.280329000283075, 34.017493000501645],
                        [-118.291534999040948, 34.018156999645896],
                        [-118.291538000078617, 34.025496999986615],
                        [-118.279978000284473, 34.021916000323188],
                        [-118.282201000275904, 34.018428000451934],
                        [-118.280329000283075, 34.017493000501645]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 813, "objectid": 813, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90018", "zcta_key": "0690018", "latitude": 34.02888703, "longitude": -118.31718332, "tot_pop": 49310, "age_under5": 3583, "age_5to9": 3433, "age_10to14": 3526, "age_15to19": 3876, "age_20to24": 3847, "age_25to29": 3963, "age_30to34": 3695, "age_35to39": 3450, "age_40to44": 3518, "age_45to49": 3370, "age_50to54": 3230, "age_55to59": 2673, "age_60to64": 1992, "age_65to69": 1465, "age_70to74": 1163, "age_75to79": 924, "age_80to84": 740, "age_85_ove": 862, "age16_over": 37965, "age18_over": 36366, "age21_over": 34134, "age62_over": 6250, "age65_over": 5154, "male": 23770, "female": 25540, "age_median": 33.2, "age_medi_1": 31.2, "age_medi_2": 35.3, "one_race": 46984, "white": 12825, "black_afam": 15663, "amind_alan": 471, "asian": 1821, "nathaw_isl": 65, "other_race": 16139, "multi_race": 2326, "hispanic_l": 29312, "non_hisp_l": 19998, "white_nhl": 1833, "black_af_1": 15111, "amind_al_1": 98, "asian_nhl": 1777, "nathaw_i_1": 41, "other_nhl": 328, "multi_ra_1": 810, "tot_in_hou": 48323, "tot_in_gc": 987, "gc_inst": 499, "gc_noninst": 488, "gc_correct": 0, "gc_juv": 12, "gc_nurs": 487, "gc_other": 0, "hh_total": 15493, "hh_family": 10515, "hh_nonfaml": 4978, "hh_nonfami": 4021, "hh_nonfa_1": 1698, "hh_nonfa_2": 480, "hh_nonfa_3": 2323, "hh_nonfa_4": 1108, "hh_with_un": 6643, "hh_with_65": 3922, "hu_total": 16658, "hu_occ": 15493, "hu_vac": 1165, "hu_vac_ren": 667, "hu_vac_sea": 22, "hu_occ_own": 4632, "hu_occ_o_1": 17274, "hu_occ_ren": 10861, "hu_occ_r_1": 31049, "Shape_Length": 0.11151808556246932, "Shape_Area": 0.00074195493581957696, "InPoly_FID": 812, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.300164999515061, 34.018177000568187],
                        [-118.300348999906362, 34.039969000069334],
                        [-118.308999000403503, 34.039938999585218],
                        [-118.32973799990873, 34.039872000092771],
                        [-118.335101000810482, 34.032579000120791],
                        [-118.335098000672133, 34.022409999721788],
                        [-118.332900000034954, 34.018232000406556],
                        [-118.324142999999424, 34.018894999504653],
                        [-118.324139999861075, 34.01613199979198],
                        [-118.321325000448383, 34.018279999922129],
                        [-118.31709000030321, 34.017254000271919],
                        [-118.300164999515061, 34.018177000568187]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 1617, "objectid": 1617, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90015", "zcta_key": "0690015", "latitude": 34.03937803, "longitude": -118.2662993, "tot_pop": 18986, "age_under5": 1206, "age_5to9": 1108, "age_10to14": 1122, "age_15to19": 1570, "age_20to24": 1932, "age_25to29": 2011, "age_30to34": 1999, "age_35to39": 1603, "age_40to44": 1300, "age_45to49": 1091, "age_50to54": 1049, "age_55to59": 839, "age_60to64": 635, "age_65to69": 458, "age_70to74": 384, "age_75to79": 316, "age_80to84": 205, "age_85_ove": 158, "age16_over": 15299, "age18_over": 14775, "age21_over": 13586, "age62_over": 1887, "age65_over": 1521, "male": 9833, "female": 9153, "age_median": 31.3, "age_medi_1": 31.7, "age_medi_2": 30.8, "one_race": 18116, "white": 6711, "black_afam": 1334, "amind_alan": 196, "asian": 2671, "nathaw_isl": 15, "other_race": 7189, "multi_race": 870, "hispanic_l": 12875, "non_hisp_l": 6111, "white_nhl": 1944, "black_af_1": 1240, "amind_al_1": 22, "asian_nhl": 2638, "nathaw_i_1": 9, "other_nhl": 60, "multi_ra_1": 198, "tot_in_hou": 18192, "tot_in_gc": 794, "gc_inst": 15, "gc_noninst": 779, "gc_correct": 0, "gc_juv": 0, "gc_nurs": 15, "gc_other": 0, "hh_total": 7420, "hh_family": 3528, "hh_nonfaml": 3892, "hh_nonfami": 3022, "hh_nonfa_1": 1711, "hh_nonfa_2": 194, "hh_nonfa_3": 1311, "hh_nonfa_4": 395, "hh_with_un": 2018, "hh_with_65": 1242, "hu_total": 8245, "hu_occ": 7420, "hu_vac": 825, "hu_vac_ren": 439, "hu_vac_sea": 90, "hu_occ_own": 1174, "hu_occ_o_1": 2588, "hu_occ_ren": 6246, "hu_occ_r_1": 15604, "Shape_Length": 0.11889099911586173, "Shape_Area": 0.00044454368351975939, "InPoly_FID": 1616, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.262823999727743, 34.046186999930171],
                        [-118.271009999511818, 34.051798999724099],
                        [-118.274313000744371, 34.051362000256177],
                        [-118.280348000259949, 34.04619300020687],
                        [-118.277896999646771, 34.045086000418621],
                        [-118.278935999896419, 34.043480000101965],
                        [-118.284101999807433, 34.039855000208149],
                        [-118.282852999766078, 34.037617999571069],
                        [-118.277704999785897, 34.036950999389148],
                        [-118.279192000010767, 34.034653999582474],
                        [-118.276742999489784, 34.036514999967324],
                        [-118.264678999835951, 34.030990999734911],
                        [-118.262446999429471, 34.029961999946408],
                        [-118.262904999865839, 34.027467000002105],
                        [-118.258560000043929, 34.025879999662322],
                        [-118.257436999517893, 34.027631000370434],
                        [-118.255489999663723, 34.030582999805631],
                        [-118.250771000581153, 34.029111999419285],
                        [-118.255076000357121, 34.03119300005693],
                        [-118.25301799988074, 34.034108000483911],
                        [-118.251453999702278, 34.033320000117953],
                        [-118.250329999130145, 34.037302999433905],
                        [-118.252710000066429, 34.039474999771471],
                        [-118.251680000231772, 34.041330000778942],
                        [-118.25409299999194, 34.040735999466847],
                        [-118.256716000443021, 34.040454999998303],
                        [-118.254942999619686, 34.041599000593465],
                        [-118.256865000119603, 34.045163000372213],
                        [-118.25820599990692, 34.043727000700585],
                        [-118.26010100006107, 34.047256000663936],
                        [-118.262823999727743, 34.046186999930171]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 995, "objectid": 995, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90011", "zcta_key": "0690011", "latitude": 34.00706962, "longitude": -118.25866986, "tot_pop": 103892, "age_under5": 10729, "age_5to9": 9723, "age_10to14": 9852, "age_15to19": 10185, "age_20to24": 9266, "age_25to29": 8853, "age_30to34": 8547, "age_35to39": 7902, "age_40to44": 7130, "age_45to49": 5865, "age_50to54": 4805, "age_55to59": 3704, "age_60to64": 2548, "age_65to69": 1665, "age_70to74": 1259, "age_75to79": 813, "age_80to84": 543, "age_85_ove": 503, "age16_over": 71589, "age18_over": 67448, "age21_over": 61485, "age62_over": 6208, "age65_over": 4783, "male": 52794, "female": 51098, "age_median": 26.2, "age_medi_1": 26.0, "age_medi_2": 26.5, "one_race": 99508, "white": 35138, "black_afam": 9764, "amind_alan": 1219, "asian": 591, "nathaw_isl": 37, "other_race": 52759, "multi_race": 4384, "hispanic_l": 92879, "non_hisp_l": 11013, "white_nhl": 720, "black_af_1": 9189, "amind_al_1": 53, "asian_nhl": 499, "nathaw_i_1": 8, "other_nhl": 224, "multi_ra_1": 320, "tot_in_hou": 103430, "tot_in_gc": 462, "gc_inst": 138, "gc_noninst": 324, "gc_correct": 0, "gc_juv": 0, "gc_nurs": 138, "gc_other": 0, "hh_total": 22168, "hh_family": 19039, "hh_nonfaml": 3129, "hh_nonfami": 2215, "hh_nonfa_1": 1084, "hh_nonfa_2": 337, "hh_nonfa_3": 1131, "hh_nonfa_4": 519, "hh_with_un": 14712, "hh_with_65": 3751, "hu_total": 23547, "hu_occ": 22168, "hu_vac": 1379, "hu_vac_ren": 647, "hu_vac_sea": 22, "hu_occ_own": 6016, "hu_occ_o_1": 31706, "hu_occ_ren": 16152, "hu_occ_r_1": 71724, "Shape_Length": 0.14847761542626686, "Shape_Area": 0.0010916252820302225, "InPoly_FID": 994, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.265184999787891, 33.989226999226673],
                        [-118.243139000264591, 33.989443000194342],
                        [-118.242953000680416, 34.009905999562307],
                        [-118.244982999865499, 34.01375299980117],
                        [-118.243237000287309, 34.014285999199558],
                        [-118.242771999528145, 34.020594999659579],
                        [-118.244138000468297, 34.019004000034613],
                        [-118.245184000141478, 34.021420999979227],
                        [-118.257436999517893, 34.027631000370434],
                        [-118.258560000043929, 34.025879999662322],
                        [-118.262904999865839, 34.027467000002105],
                        [-118.262446999429471, 34.029961999946408],
                        [-118.264678999835951, 34.030990999734911],
                        [-118.271600999786301, 34.020255999314941],
                        [-118.268370999222213, 34.018818000450437],
                        [-118.272625000243522, 34.018654000082108],
                        [-118.274009000215131, 34.013057000080551],
                        [-118.273927999177772, 33.989191000264498],
                        [-118.270526000574421, 33.986067000092021],
                        [-118.270528000666673, 33.98920500001077],
                        [-118.265184999787891, 33.989226999226673]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 620, "objectid": 620, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90037", "zcta_key": "0690037", "latitude": 34.00272303, "longitude": -118.28748673, "tot_pop": 62276, "age_under5": 5553, "age_5to9": 4980, "age_10to14": 5065, "age_15to19": 5769, "age_20to24": 5752, "age_25to29": 5266, "age_30to34": 4886, "age_35to39": 4505, "age_40to44": 4268, "age_45to49": 4080, "age_50to54": 3619, "age_55to59": 2802, "age_60to64": 1842, "age_65to69": 1323, "age_70to74": 909, "age_75to79": 672, "age_80to84": 513, "age_85_ove": 472, "age16_over": 45574, "age18_over": 43233, "age21_over": 39731, "age62_over": 4891, "age65_over": 3889, "male": 31187, "female": 31089, "age_median": 28.8, "age_medi_1": 28.0, "age_medi_2": 29.7, "one_race": 59755, "white": 16395, "black_afam": 13893, "amind_alan": 686, "asian": 540, "nathaw_isl": 58, "other_race": 28183, "multi_race": 2521, "hispanic_l": 46954, "non_hisp_l": 15322, "white_nhl": 698, "black_af_1": 13315, "amind_al_1": 112, "asian_nhl": 471, "nathaw_i_1": 22, "other_nhl": 280, "multi_ra_1": 424, "tot_in_hou": 61104, "tot_in_gc": 1172, "gc_inst": 114, "gc_noninst": 1058, "gc_correct": 0, "gc_juv": 20, "gc_nurs": 94, "gc_other": 0, "hh_total": 15869, "hh_family": 12190, "hh_nonfaml": 3679, "hh_nonfami": 2755, "hh_nonfa_1": 1327, "hh_nonfa_2": 324, "hh_nonfa_3": 1428, "hh_nonfa_4": 569, "hh_with_un": 8708, "hh_with_65": 3068, "hu_total": 17192, "hu_occ": 15869, "hu_vac": 1323, "hu_vac_ren": 792, "hu_vac_sea": 19, "hu_occ_own": 4035, "hu_occ_o_1": 18244, "hu_occ_ren": 11834, "hu_occ_r_1": 42860, "Shape_Length": 0.10762717293575573, "Shape_Area": 0.00070996004547535703, "InPoly_FID": 619, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.300164999515061, 34.018177000568187],
                        [-118.300192999906983, 33.989109000080362],
                        [-118.283203999764737, 33.989138999665158],
                        [-118.273927999177772, 33.989191000264498],
                        [-118.274009000215131, 34.013057000080551],
                        [-118.282758999927864, 34.01651400032091],
                        [-118.291536999133143, 34.015480999448641],
                        [-118.293070999726808, 34.018160000683508],
                        [-118.300164999515061, 34.018177000568187]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 1600, "objectid": 1600, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90047", "zcta_key": "0690047", "latitude": 33.95448489, "longitude": -118.30900384, "tot_pop": 48606, "age_under5": 3134, "age_5to9": 3208, "age_10to14": 3622, "age_15to19": 4240, "age_20to24": 3622, "age_25to29": 3000, "age_30to34": 2815, "age_35to39": 2978, "age_40to44": 3374, "age_45to49": 3542, "age_50to54": 3420, "age_55to59": 2854, "age_60to64": 2388, "age_65to69": 1903, "age_70to74": 1746, "age_75to79": 1345, "age_80to84": 764, "age_85_ove": 651, "age16_over": 37811, "age18_over": 36060, "age21_over": 33614, "age62_over": 7767, "age65_over": 6409, "male": 22129, "female": 26477, "age_median": 36.2, "age_medi_1": 32.7, "age_medi_2": 38.8, "one_race": 46950, "white": 5734, "black_afam": 31915, "amind_alan": 223, "asian": 260, "nathaw_isl": 54, "other_race": 8764, "multi_race": 1656, "hispanic_l": 15393, "non_hisp_l": 33213, "white_nhl": 446, "black_af_1": 31446, "amind_al_1": 73, "asian_nhl": 235, "nathaw_i_1": 45, "other_nhl": 233, "multi_ra_1": 735, "tot_in_hou": 48376, "tot_in_gc": 230, "gc_inst": 33, "gc_noninst": 197, "gc_correct": 0, "gc_juv": 21, "gc_nurs": 12, "gc_other": 0, "hh_total": 16168, "hh_family": 11570, "hh_nonfaml": 4598, "hh_nonfami": 3887, "hh_nonfa_1": 1421, "hh_nonfa_2": 480, "hh_nonfa_3": 2466, "hh_nonfa_4": 1146, "hh_with_un": 6608, "hh_with_65": 5160, "hu_total": 17150, "hu_occ": 16168, "hu_vac": 982, "hu_vac_ren": 511, "hu_vac_sea": 20, "hu_occ_own": 9029, "hu_occ_o_1": 28177, "hu_occ_ren": 7139, "hu_occ_r_1": 20199, "Shape_Length": 0.21637266890404758, "Shape_Area": 0.0011927289859765689, "InPoly_FID": 1599, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.317747000923305, 33.9709230004961],
                        [-118.317719999678218, 33.945463000017469],
                        [-118.317752999401364, 33.930901000280983],
                        [-118.313392000640306, 33.930911999888963],
                        [-118.313393999833181, 33.923532000401565],
                        [-118.317769999285986, 33.921720999624483],
                        [-118.317786999170664, 33.917683000470163],
                        [-118.314593999413489, 33.918536000236259],
                        [-118.314247000498654, 33.916449999368012],
                        [-118.300379000390535, 33.917410000471193],
                        [-118.300308000713642, 33.927271000156566],
                        [-118.309055000288026, 33.926293000021985],
                        [-118.30896199959659, 33.929255999964482],
                        [-118.300297999353177, 33.930155000053276],
                        [-118.300259000252652, 33.98142200082475],
                        [-118.302404000244394, 33.981417999740927],
                        [-118.300255000068148, 33.982344999322322],
                        [-118.300192999906983, 33.989109000080362],
                        [-118.317131000395307, 33.989101999757509],
                        [-118.317679999632219, 33.984398000467422],
                        [-118.321735000469857, 33.982140000660536],
                        [-118.317683999816722, 33.983864999270338],
                        [-118.317747000923305, 33.9709230004961]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 971, "objectid": 971, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90061", "zcta_key": "0690061", "latitude": 33.92036138, "longitude": -118.27407221, "tot_pop": 26872, "age_under5": 2469, "age_5to9": 2310, "age_10to14": 2434, "age_15to19": 2550, "age_20to24": 2291, "age_25to29": 1992, "age_30to34": 1887, "age_35to39": 1843, "age_40to44": 1763, "age_45to49": 1737, "age_50to54": 1509, "age_55to59": 1216, "age_60to64": 786, "age_65to69": 611, "age_70to74": 484, "age_75to79": 419, "age_80to84": 285, "age_85_ove": 286, "age16_over": 19158, "age18_over": 18147, "age21_over": 16589, "age62_over": 2502, "age65_over": 2085, "male": 13049, "female": 13823, "age_median": 28.4, "age_medi_1": 27.0, "age_medi_2": 29.8, "one_race": 25893, "white": 5794, "black_afam": 10026, "amind_alan": 170, "asian": 96, "nathaw_isl": 44, "other_race": 9763, "multi_race": 979, "hispanic_l": 16379, "non_hisp_l": 10493, "white_nhl": 260, "black_af_1": 9767, "amind_al_1": 47, "asian_nhl": 82, "nathaw_i_1": 22, "other_nhl": 65, "multi_ra_1": 250, "tot_in_hou": 26509, "tot_in_gc": 363, "gc_inst": 249, "gc_noninst": 114, "gc_correct": 0, "gc_juv": 0, "gc_nurs": 249, "gc_other": 0, "hh_total": 6892, "hh_family": 5461, "hh_nonfaml": 1431, "hh_nonfami": 1159, "hh_nonfa_1": 533, "hh_nonfa_2": 162, "hh_nonfa_3": 626, "hh_nonfa_4": 257, "hh_with_un": 3814, "hh_with_65": 1615, "hu_total": 7385, "hu_occ": 6892, "hu_vac": 493, "hu_vac_ren": 279, "hu_vac_sea": 6, "hu_occ_own": 2889, "hu_occ_o_1": 11741, "hu_occ_ren": 4003, "hu_occ_r_1": 14768, "Shape_Length": 0.13221878281057614, "Shape_Area": 0.00066267786922131165, "InPoly_FID": 970, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "MultiPolygon",
                "coordinates": [
                    [
                        [
                            [-118.282708000273942, 33.916421999875467],
                            [-118.282748000319941, 33.901892999862127],
                            [-118.263149000326052, 33.90237600055201],
                            [-118.265275999487756, 33.911532000101772],
                            [-118.265158000341387, 33.938348000160147],
                            [-118.282594000412757, 33.939180999903272],
                            [-118.284803999804694, 33.935609999801727],
                            [-118.282590999375088, 33.935621999455748],
                            [-118.28259300036666, 33.929776000562015],
                            [-118.286956000119289, 33.929761999916423],
                            [-118.280567000466647, 33.928498999229475],
                            [-118.28479600033512, 33.927349000156312],
                            [-118.284786000773295, 33.923710999662944],
                            [-118.282577999674913, 33.923719000031895],
                            [-118.282708000273942, 33.916421999875467]
                        ]
                    ],
                    [
                        [
                            [-118.285631000170497, 33.916421999875467],
                            [-118.285055999734539, 33.915199000133782],
                            [-118.284553000820324, 33.916421999875467],
                            [-118.285328999733508, 33.916421999875467],
                            [-118.285631000170497, 33.916421999875467]
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 82, "objectid": 82, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90062", "zcta_key": "0690062", "latitude": 34.00363839, "longitude": -118.30880632, "tot_pop": 32821, "age_under5": 2466, "age_5to9": 2384, "age_10to14": 2539, "age_15to19": 2991, "age_20to24": 2715, "age_25to29": 2456, "age_30to34": 2311, "age_35to39": 2202, "age_40to44": 2331, "age_45to49": 2304, "age_50to54": 2200, "age_55to59": 1690, "age_60to64": 1275, "age_65to69": 935, "age_70to74": 716, "age_75to79": 564, "age_80to84": 388, "age_85_ove": 354, "age16_over": 24830, "age18_over": 23636, "age21_over": 21870, "age62_over": 3657, "age65_over": 2957, "male": 15720, "female": 17101, "age_median": 31.8, "age_medi_1": 29.9, "age_medi_2": 33.7, "one_race": 31348, "white": 6955, "black_afam": 12420, "amind_alan": 275, "asian": 387, "nathaw_isl": 28, "other_race": 11283, "multi_race": 1473, "hispanic_l": 19373, "non_hisp_l": 13448, "white_nhl": 370, "black_af_1": 12024, "amind_al_1": 58, "asian_nhl": 368, "nathaw_i_1": 13, "other_nhl": 226, "multi_ra_1": 389, "tot_in_hou": 32528, "tot_in_gc": 293, "gc_inst": 17, "gc_noninst": 276, "gc_correct": 0, "gc_juv": 17, "gc_nurs": 0, "gc_other": 0, "hh_total": 9155, "hh_family": 6830, "hh_nonfaml": 2325, "hh_nonfami": 1909, "hh_nonfa_1": 777, "hh_nonfa_2": 224, "hh_nonfa_3": 1132, "hh_nonfa_4": 505, "hh_with_un": 4427, "hh_with_65": 2435, "hu_total": 9795, "hu_occ": 9155, "hu_vac": 640, "hu_vac_ren": 285, "hu_vac_sea": 16, "hu_occ_own": 3961, "hu_occ_o_1": 15996, "hu_occ_ren": 5194, "hu_occ_r_1": 16532, "Shape_Length": 0.09112663795216186, "Shape_Area": 0.00049156232955929486, "InPoly_FID": 81, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.300192999906983, 33.989109000080362],
                        [-118.300164999515061, 34.018177000568187],
                        [-118.31709000030321, 34.017254000271919],
                        [-118.317618999517208, 34.003689999793721],
                        [-118.317131000395307, 33.989101999757509],
                        [-118.300192999906983, 33.989109000080362]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 973, "objectid": 973, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90044", "zcta_key": "0690044", "latitude": 33.95272934, "longitude": -118.29190368, "tot_pop": 89779, "age_under5": 8270, "age_5to9": 7777, "age_10to14": 7880, "age_15to19": 8309, "age_20to24": 7571, "age_25to29": 7068, "age_30to34": 6385, "age_35to39": 5937, "age_40to44": 6059, "age_45to49": 5761, "age_50to54": 5347, "age_55to59": 3946, "age_60to64": 2903, "age_65to69": 2102, "age_70to74": 1716, "age_75to79": 1253, "age_80to84": 797, "age_85_ove": 698, "age16_over": 64240, "age18_over": 60887, "age21_over": 55933, "age62_over": 8172, "age65_over": 6566, "male": 43128, "female": 46651, "age_median": 28.6, "age_medi_1": 27.2, "age_medi_2": 29.9, "one_race": 86213, "white": 20135, "black_afam": 33656, "amind_alan": 666, "asian": 338, "nathaw_isl": 81, "other_race": 31337, "multi_race": 3566, "hispanic_l": 54351, "non_hisp_l": 35428, "white_nhl": 895, "black_af_1": 32766, "amind_al_1": 133, "asian_nhl": 282, "nathaw_i_1": 67, "other_nhl": 456, "multi_ra_1": 829, "tot_in_hou": 89319, "tot_in_gc": 460, "gc_inst": 101, "gc_noninst": 359, "gc_correct": 20, "gc_juv": 11, "gc_nurs": 70, "gc_other": 0, "hh_total": 25144, "hh_family": 18932, "hh_nonfaml": 6212, "hh_nonfami": 5031, "hh_nonfa_1": 2175, "hh_nonfa_2": 709, "hh_nonfa_3": 2856, "hh_nonfa_4": 1164, "hh_with_un": 13272, "hh_with_65": 5414, "hu_total": 27479, "hu_occ": 25144, "hu_vac": 2335, "hu_vac_ren": 1514, "hu_vac_sea": 25, "hu_occ_own": 7899, "hu_occ_o_1": 30892, "hu_occ_ren": 17245, "hu_occ_r_1": 58427, "Shape_Length": 0.21817097272500047, "Shape_Area": 0.0012762850512844199, "InPoly_FID": 972, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [-118.300259000252652, 33.98142200082475],
                        [-118.300297999353177, 33.930155000053276],
                        [-118.30896199959659, 33.929255999964482],
                        [-118.309055000288026, 33.926293000021985],
                        [-118.300308000713642, 33.927271000156566],
                        [-118.300379000390535, 33.917410000471193],
                        [-118.285944999362187, 33.916422000774787],
                        [-118.285631000170497, 33.916421999875467],
                        [-118.285328999733508, 33.916421999875467],
                        [-118.284553000820324, 33.916421999875467],
                        [-118.282708000273942, 33.916421999875467],
                        [-118.282577999674913, 33.923719000031895],
                        [-118.284786000773295, 33.923710999662944],
                        [-118.28479600033512, 33.927349000156312],
                        [-118.280567000466647, 33.928498999229475],
                        [-118.286956000119289, 33.929761999916423],
                        [-118.28259300036666, 33.929776000562015],
                        [-118.282590999375088, 33.935621999455748],
                        [-118.284803999804694, 33.935609999801727],
                        [-118.282594000412757, 33.939180999903272],
                        [-118.283203999764737, 33.989138999665158],
                        [-118.300192999906983, 33.989109000080362],
                        [-118.300255000068148, 33.982344999322322],
                        [-118.302404000244394, 33.981417999740927],
                        [-118.300259000252652, 33.98142200082475]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "OBJECTID_1": 1376, "objectid": 1376, "cnty_fips": "", "county": "", "tract": "", "tract_id": "", "census_key": "", "zcta": "90089", "zcta_key": "0690089", "latitude": 34.02443542, "longitude": -118.28028332, "tot_pop": 3217, "age_under5": 0, "age_5to9": 0, "age_10to14": 0, "age_15to19": 2627, "age_20to24": 518, "age_25to29": 40, "age_30to34": 12, "age_35to39": 5, "age_40to44": 7, "age_45to49": 1, "age_50to54": 6, "age_55to59": 0, "age_60to64": 0, "age_65to69": 0, "age_70to74": 1, "age_75to79": 0, "age_80to84": 0, "age_85_ove": 0, "age16_over": 3217, "age18_over": 3177, "age21_over": 310, "age62_over": 1, "age65_over": 1, "male": 1436, "female": 1781, "age_median": 19.3, "age_medi_1": 19.3, "age_medi_2": 19.2, "one_race": 2985, "white": 1618, "black_afam": 147, "amind_alan": 2, "asian": 1120, "nathaw_isl": 2, "other_race": 96, "multi_race": 232, "hispanic_l": 355, "non_hisp_l": 2862, "white_nhl": 1425, "black_af_1": 135, "amind_al_1": 1, "asian_nhl": 1110, "nathaw_i_1": 2, "other_nhl": 5, "multi_ra_1": 184, "tot_in_hou": 60, "tot_in_gc": 3157, "gc_inst": 0, "gc_noninst": 3157, "gc_correct": 0, "gc_juv": 0, "gc_nurs": 0, "gc_other": 0, "hh_total": 31, "hh_family": 1, "hh_nonfaml": 30, "hh_nonfami": 2, "hh_nonfa_1": 0, "hh_nonfa_2": 0, "hh_nonfa_3": 2, "hh_nonfa_4": 0, "hh_with_un": 2, "hh_with_65": 0, "hu_total": 31, "hu_occ": 31, "hu_vac": 0, "hu_vac_ren": 0, "hu_vac_sea": 0, "hu_occ_own": 0, "hu_occ_o_1": 0, "hu_occ_ren": 31, "hu_occ_r_1": 60, "Shape_Length": 0.046485163198829886, "Shape_Area": 6.8303122274791718e-05, "InPoly_FID": 1375, "SimPgnFlag": 0, "MaxSimpTol": 0.0014473214335623029, "MinSimpTol": 0.0014473214335623029 },
            "geometry": {
                "type": "MultiPolygon",
                "coordinates": [
                    [
                        [
                            [-118.291534999040948, 34.018156999645896],
                            [-118.280329000283075, 34.017493000501645],
                            [-118.282201000275904, 34.018428000451934],
                            [-118.279978000284473, 34.021916000323188],
                            [-118.291538000078617, 34.025496999986615],
                            [-118.291534999040948, 34.018156999645896]
                        ]
                    ],
                    [
                        [
                            [-118.205086000018866, 34.059643000823883],
                            [-118.203489000117202, 34.061301999987336],
                            [-118.204974000249877, 34.06239600007541],
                            [-118.207358000471288, 34.060642000128269],
                            [-118.205086000018866, 34.059643000823883]
                        ]
                    ]
                ]
            }
        }
    ]
};

// declare variables

let mapOptions = {'center': [33.98,-118.3],'zoom':12}

let liveZip = ""; 

let layers;

const dataUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTa9AVc8UTLUefFtEnv8xTqtDgW7F1K_LBDJRJMQ4pXyP7XY0yb1T6cP0fIesA69CNpO8S5YJfY8EPr/pub?output=csv"

// define the leaflet map
const map = L.map('the_map').setView(mapOptions.center, mapOptions.zoom);


//map aesthetics
let CartoDB_Positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	subdomains: 'abcd',
	maxZoom: 20
});

CartoDB_Positron.addTo(map)

document.getElementById("stories").innerHTML = "Click on any ZIP code to view community stories here under the Stories tab. A graphical summary of responses will be displayed under the Summary tab."; 

//shading map based on zip codes
//initial value of 0 before stories are processed
let shading = {
    "90001": 0,
    "90002": 0,
    "90003": 0, 
    "90007": 0, 
    "90018": 0, 
    "90011": 0, 
    "90037": 0, 
    "90047": 0, 
    "90061": 0, 
    "90062": 0,
    "90044": 0,
    "90089": 0,
    "90015": 0
};

let responseLength = 0; 

//Function to process data and update shading values
function processData(results){
    responseLength = results.data.length; 
    console.log(results)
    results.data.forEach(data => {
        if (shading[data['Zip Code']] !== undefined) {
            shading[data['Zip Code']]++;
        }
    });
    return shading
}

// Function to get color based on zip code data (for shading)
function getColor(d) {
    console.log(responseLength)
    let x = shading[d]/responseLength; // proportion of responses per zip code 
    console.log(x)
    return x >= 0.8 ? '#991f00' :
           x >= 0.6  ? '#cc2900' :
           x >= 0.4 ? '#ff3300' :
           x >= 0.2  ? '#FF663F' :
           x > 0   ? '#FF967F' :
                      '#FFFFFF';
}

// Function to define the style for the zip code areas
function style(feature) {
    return {
        fillColor: getColor(feature.properties.zcta),
        weight: 2,
        opacity: 1,
        color: "#8E270A",
        dashArray: '3',
        fillOpacity: 1
    };
}


// Add interactivity: highlight on mouseover
function highlightFeature(e) {
    var layer = e.target;
    layer.setStyle({
        weight: 5,
    });
    info.update(layer.feature.properties);
}

// Reset style on mouseout
function resetHighlight(e) {
    if (e.target.feature.properties.zcta != liveZip){
        geojson.resetStyle(e.target);
    }
    else if (prev != e.target){
        geojson.resetStyle(e.target);
    }
    info.update();
}

let prev = null; 

// Add interactivity: events when zip code is clicked
function clickAZipCode(e) {
    if (liveZip == ""){ // only happens once 
        prev = e.target; 
    }
    else if (e.target.feature.properties.zcta != liveZip){
        geojson.resetStyle(prev)
    }
    liveZip = e.target.feature.properties.zcta; 
    highlightFeature(e); 
    loadData2(dataUrl)
    document.getElementById("stories").innerHTML = ""; 
    document.getElementById("summary").innerHTML = ""; 
}

// Load data for specific zip code on click
function loadData2(url){
    Papa.parse(url, {
        header: true,
        download: true,
        complete: results => {
            createStory(results, liveZip); 
            createSummary(results, liveZip)
        }
    })
}

// Define the interactions for each feature
function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: clickAZipCode,
    });
}

// GeoJSON layer - initially NOT added to the map
let geojson;

// Process data and then add the layer to the map
Papa.parse(dataUrl, {
    header: true,
    download: true,
    complete: results => {
        processData(results);

        // Now that the data is ready, add to map
        geojson = L.geoJson(zips, {
            style: style,
            onEachFeature: onEachFeature
        }).addTo(map);
    }
})

// Populate "Story" tab
function createStory(results, currZip){
    const item = document.createElement("list"); 
    item.id = "words"; 
    const itemspace = document.getElementById("stories");
    itemspace.appendChild(item); 
    
    let count = 0; 
    let length = shading[currZip]; 
    item.innerHTML += `<h3>Voices from ${currZip}</h3>`; 
    if (length == 0) { // if no responses yet
        item.innerHTML += '<p>Currently, no stories have been collected for this ZIP code. Please check back later!</p>'
    }
    results.data.forEach(data => {
        if (data['Zip Code'] == currZip)
    {
        count++; 
        item.innerHTML += `<p><i>Story ${count} of ${length}</i></p>`; 
        item.innerHTML += `<p><strong><a href=${data["Interview Recording"]} target="_blank" rel="noopener noreferrer">Listen to the full interview.</a></strong></p>` 
        item.innerHTML += `<p><strong>Interview Highlight: </strong>${data["Interview Highlight"]}</p>`
        item.innerHTML += `<p><strong>Full Transcript: </strong>${data["Full Transcript of Interview"]}</p>`
        item.innerHTML += `<br/><hr><br/>`; 

    }
        
    }
    )
}

//populate the Summary tab
function createSummary(results, currZip){
    const item = document.createElement("list"); 
    item.id = "words"; 
    const itemspace = document.getElementById("summary");
    itemspace.appendChild(item);
    item.innerHTML += `<h3>Summary of data from ${currZip}</h3>`; 
    item.innerHTML+=`<p>Insert relevant data visualizations here.</p>`;
}

//create separate layer groups for each well status
var activeWellsLayer = L.layerGroup();
var idleWellsLayer = L.layerGroup();
var pluggedWellsLayer = L.layerGroup();
var otherWellsLayer = L.layerGroup();

//function to change colors of markers based on well status
function getMarkerStyle(status) {
    let color;
    switch (status) {
        case 'Active': 
            color = "#00d423";  // Green for Active wells
            break;
        case 'Idle':
            color = "#ff7800";  // Orange for Idle wells
            break;
        case 'Plugged':
            color = "#969696";  // Gray for Plugged wells
            break;
        case 'PluggedOnly':
            color = "#969696";  // Gray for Plugged wells
            break;
        default:
            color = "#0a78ff";  // Blue for other statuses
    }
    return {
        radius: 5,         // Circle marker size
        fillColor: color, // Color of the circle
        color: "#000",      // Border color
        weight: 1,          // Border width
        opacity: 1,         // Border opacity
        fillOpacity: 0.8    // Fill opacity
    };
}

// Fetch the GeoJSON file and add it to the oilGasWellsLayer
fetch("LA_oil_gas_wells.geojson") 
    .then(response => response.json())
    .then(data => {
        // Filter features based on coordinates (roughly the area of South LA)
        const filteredFeatures = data.features.filter(feature => {
            return (feature.properties.oil_gas_latitude >= 33.902197 && feature.properties.oil_gas_latitude <= 34.053022 && feature.properties.oil_gas_longitude >= -118.335143 && feature.properties.oil_gas_longitude <= -118.222650); 
        });

        // Create a GeoJSON layer with only the filtered features (points within rough boundires of South LA)
        filteredFeatures.forEach(feature => {
            const latlng = [feature.properties.oil_gas_latitude, feature.properties.oil_gas_longitude];
            const wellStatus = feature.properties.oil_gas_wellstatus;
            const marker = L.circleMarker(latlng, getMarkerStyle(wellStatus))
                .bindPopup(
                    `<b>Operator Name: </b>${feature.properties.oil_gas_operatorname}<br><b>Status: </b>${feature.properties.oil_gas_wellstatus}`
                );

            // Add the GeoJSON layer to the appropriate group, based on well status
            if (feature.properties.oil_gas_wellstatus === 'Active') {
                activeWellsLayer.addLayer(marker);
            } else if (feature.properties.oil_gas_wellstatus === 'Idle') {
                idleWellsLayer.addLayer(marker);
            } else if (feature.properties.oil_gas_wellstatus === ('Plugged' || 'PluggedOnly')) {
                pluggedWellsLayer.addLayer(marker);
            } else {
                otherWellsLayer.addLayer(marker);
            }
    });

    //Add the layer control to the map
    var overlayMaps = {
        "Active Wells": activeWellsLayer,
        "Idle Wells": idleWellsLayer,
        "Plugged Wells": pluggedWellsLayer,
         "Other Wells": otherWellsLayer
    };

    L.control.layers(null, overlayMaps).addTo(map); //base layers as null since I'm using the default OSM layer
});

function openTab(evt, tabname) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace("active", "");
    }
    document.getElementById(tabname).style.display = "block";
    evt.currentTarget.className += " active";
  }


  // Get the element with id="defaultOpen" and click on it
  document.getElementById("defaultOpen").click();

//legend
let legend = L.control({ position: "bottomright" });
legend.onAdd = function (map) {
	let div = L.DomUtil.create("div", "info legend");

	div.style.backgroundColor = "white";
	div.style.padding = "10px";
	div.style.borderRadius = "5px";
	div.style.fontFamily = "font-family: 'Archivo', sans-serif"; //FIX THIS WITH UPDATED FONT

	div.innerHTML =
		"<b>Key:</b> Proportion of total responses from each ZIP code<br><br>";

	div.innerHTML +=
		'<i style="background:#991f00; width: 18px; height: 18px; float: left; margin-right: 5px;"></i> ' +
		"0.8 &ndash; 1<br>" +
		'<i style="background:#cc2900; width: 18px; height: 18px; float: left; margin-right: 5px;"></i> ' +
		"0.6 &ndash; 0.8<br>" +
		'<i style="background:#ff3300; width: 18px; height: 18px; float: left; margin-right: 5px;"></i> ' +
		"0.4 &ndash; 0.6<br>" +
		'<i style="background:#FF663F; width: 18px; height: 18px; float: left; margin-right: 5px;"></i> ' +
        "0.2 &ndash; 0.4<br>" +
        '<i style="background:#FF967F; width: 18px; height: 18px; float: left; margin-right: 5px;"></i> ' +
		"0 &ndash; 0.2<br>";
	return div;
};
legend.addTo(map);

//info pop-up for mouseover
var info = L.control();

info.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    this.update();
    return this._div;
};

// method that we will use to update the control based on feature properties passed
info.update = function (zips) {
    this._div.innerHTML = '<h4>ZIP Code Information</h4>' +  (zips ?
        '<b>' + zips.zcta + '</b><br />' + shading[zips.zcta] + ' responses'
        : 'Hover over a region <br> to learn more.');
};

info.addTo(map);

//modal stuff
//get modal
var modal2 = document.getElementById("myModal");

//get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

//when the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal2.style.display = "none";
}

window.onload = function() {
    modal2.style.display = "block";
  };
  
window.onclick = function(event) {
if (event.target == modal2) {
    modal2.style.display = "none";
}
}

//get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

//when the user clicks on the button, open the modal
btn.onclick = function() {
  modal2.style.display = "grid";
}

//when the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal2.style.display = "none";
}
